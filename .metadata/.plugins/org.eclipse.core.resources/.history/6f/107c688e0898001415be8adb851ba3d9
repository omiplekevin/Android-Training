package com.example.timereminder;

import java.util.Locale;

import android.app.Service;
import android.content.Intent;
import android.media.Ringtone;
import android.media.RingtoneManager;
import android.net.Uri;
import android.os.IBinder;
import android.speech.tts.TextToSpeech;
import android.speech.tts.TextToSpeech.OnInitListener;
import android.speech.tts.TextToSpeech.OnUtteranceCompletedListener;

@SuppressWarnings("deprecation")
public class MessageReaderService extends Service implements OnInitListener, OnUtteranceCompletedListener{
	
	static private TextToSpeech tts;
	private String message = "";
	
	@Override
	public void onCreate() {
		// TODO Auto-generated method stub
	}

	@Override
	public int onStartCommand(Intent intent, int flags, int startId) {
		// TODO Auto-generated method stub
		message = intent.getExtras().getString("MSG");
		tts = new TextToSpeech(this, this);
		return 0;
	}



	@Override
	public void onInit(int status) {
		// TODO Auto-generated method stub
		if (status == TextToSpeech.SUCCESS) {
            int result = tts.setLanguage(Locale.US);
            if (result != TextToSpeech.LANG_MISSING_DATA && result != TextToSpeech.LANG_NOT_SUPPORTED) {
            	String x = "";
            	if(message.contains("PM")) {
            		x = "evening";
            	} else {
            		x = "morning";
            	}
            	
            	/*try {
            	    Uri notification = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);
            	    Ringtone r = RingtoneManager.getRingtone(getApplicationContext(), notification);
            	    r.play();
            	    Thread.sleep(2000);
            	} catch (Exception e) {
            	    e.printStackTrace();
            	}*/
            	
            	String newMsg = message.substring(0, message.length()-2);
            	tts.setPitch(0.85f);
            	tts.setSpeechRate(2.0f);
                tts.speak("It's now " + newMsg + " in the " + x, TextToSpeech.QUEUE_FLUSH, null);
            }
        }
	}

	@Override
	public IBinder onBind(Intent intent) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public void onDestroy() {
		// TODO Auto-generated method stub
		if(tts != null) {
			tts.stop();
			tts.shutdown();
			tts = null;
		}
		super.onDestroy();
	}

	@Override
	public void onUtteranceCompleted(String utteranceId) {
		// TODO Auto-generated method stub
		stopSelf();
	}

}
